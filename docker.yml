---
- name: Install Docker
  hosts: localhost
  remote_user: scott
  become: true
  tasks:
   - name: Install dependencies
     apt:
       name: "{{item}}"
       state: present
       update_cache: yes
     loop:
      - apt-transport-https
      - ca-certificates
      - curl
      - gnupg-agent
      - software-properties-common
   - name: add GPG key
     ansible.builtin.get_url:
        url: https://download.docker.com/linux/ubuntu/gpg
        dest: /usr/share/keyrings/docker.gpg
       # state: present
   - name: add docker repository to apt
     ansible.builtin.apt_repository:
       repo: deb [arch=amd64 signed-by=/usr/share/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu questing stable
       state: present
   - name: Update apt cache
     ansible.builtin.apt:
       update_cache: yes
   - name: install docker
     apt:
       name: "{{item}}"
       state: latest
       update_cache: yes
     loop:
       - docker-ce
       - docker-ce-cli
       - containerd.io
   - name: check docker is active
     service:
       name: docker
       state: started
       enabled: yes
   - name: Ensure group "docker" exists
     ansible.builtin.group:
       name: docker
       state: present
   - name: adding ubunut to docker group
     user:
       name: ubuntu
       groups: docker
       append: yes
   - name: Install docker-compose
     get_url:
       url: https://github.com/docker/compose/releases/download/v2.40.0/docker-compose-Linux-x86_64
       dest: /usr/local/bin/docker-compose
       mode: '0754'
   - name: Change file ownership, group and permissions
     ansible.builtin.file:
       path: /usr/local/bin/docker-compose
       owner: ubuntu
       group: ubuntu
